#include "ov7670_regs.h"

// -------------------------------------------------------------------------
// === OV7670 register‐list definitions (exactly one copy) ===
// -------------------------------------------------------------------------

// “OV7670_init” holds 93 register/value pairs that configure the camera for 80×60 RGB565.
const uint8_t OV7670_init[93][2] = {
    // TSLB: No auto window, YLAST
    {0x3A, 0x04},
    // COM7: Default (leave PAL/NTSC = 0x00 for RGB)
    {0x12, 0x00},
    // COM15: RGB565, full‐range
    {0x40, 0x10},
    // COM3: DCW enable (down‐sample)
    {0x0C, 0x04},
    // COM14: PCLK scaling for sub‐VGA
    {0x3E, 0x19},
    // SCALING_XSC (will overwrite bits later)
    {0x70, 0x3A},
    // SCALING_YSC (will overwrite bits later)
    {0x71, 0x35},
    // SCALING_DCWCTR: down‐sample ratio
    {0x72, 0x11},
    // SCALING_PCLK_DIV: sub‐VGA clock divider
    {0x73, 0xF1},
    // SCALING_PCLK_DELAY
    {0xA2, 0x02},

    // Gamma curve: 15 entries (base + 14 more)
    {0x7B, 0x1C}, {0x7C, 0x28}, {0x7D, 0x3C}, {0x7E, 0x55},
    {0x7F, 0x68}, {0x80, 0x76}, {0x81, 0x80}, {0x82, 0x88},
    {0x83, 0x8F}, {0x84, 0x96}, {0x85, 0xA3}, {0x86, 0xAF},
    {0x87, 0xC4}, {0x88, 0xD7}, {0x89, 0xE8},

    // COM8: Fast‐AEC, Banding, AEC on, AGC on, AWB on
    {0x13, 0xE5},
    // GAIN: 0 (auto gain)
    {0x00, 0x00},
    // BLUE: AWB Blue gain
    {0x01, 0x00},
    // RED: AWB Red gain
    {0x02, 0x00},
    // VREF: frame control
    {0x03, 0x00},
    // COM1: no special modes
    {0x04, 0x00},
    // COM2: no soft sleep
    {0x09, 0x00},
    // COM10: 0x40 = suppress PCLK on HBLANK, negative VSYNC
    {0x0D, 0x40},
    // COM5: reserved
    {0x0E, 0x00},
    // COM6: reserved
    {0x0F, 0x00},

    // AECHH
    {0x10, 0x00},
    // EXHCL
    {0x11, 0x00},
    // AEW (upper AEC limit)
    {0x24, 0x75},
    // AEB (lower AEC limit)
    {0x25, 0x63},
    // VPT
    {0x26, 0xA5},

    // HAECC (histogram‐based AEC/AGC)
    {0x30, 0x78}, {0x31, 0x68}, {0x32, 0x03},
    {0x33, 0xDF}, {0x34, 0xDF}, {0x35, 0xF0},
    {0x36, 0x90}, {0x37, 0x94},

    // Further PLL/clock config
    {0x6B, 0x0A},  // DBLV: PLL on, ×4

    // Reserved entries (just to pad up to 93)
    {0x8F, 0x00},  // Reserved
    {0x90, 0x00},
    {0x91, 0x00},
    {0x92, 0x00},
    {0x93, 0x00},
    {0x94, 0x00},
    {0x95, 0x00},
    {0x96, 0x00},
    {0x9A, 0x80},
    {0xB0, 0x84},
    {0xB1, 0x0C},  // ABLC1
    {0xB2, 0x0E},  // Reserved
    {0xB8, 0x0A},  // Reserved

    // AWB registers
    {0x43, 0x14}, {0x44, 0xF0}, {0x45, 0x34}, {0x46, 0x58},
    {0x47, 0x28}, {0x48, 0x3A}, {0x59, 0x88}, {0x5A, 0x88},
    {0x5B, 0x44}, {0x5C, 0x67}, {0x5D, 0x49}, {0x5E, 0x0E},
    {0x6C, 0x04}, {0x6D, 0x20}, {0x6E, 0x05}, {0x6F, 0x3A},
    {0x67, 0x0A}, {0x68, 0x55}, {0x69, 0x11}, {0x6A, 0x9F},

    // LCC (Lens correction) registers (unused in RGB565, but set anyway)
    {0x64, 0x00},  // LCC3
    {0x65, 0x40},  // LCC4
    {0x66, 0x20},  // LCC5
    {0x6A, 0x9F},  // AWBCTR0

    // Final placeholder to reach 93 entries
    {0xFF, 0xFF}
};

// “OV7670_rgb” selects RGB565 output format on COM7/COM15/RGB444
const uint8_t OV7670_rgb[3][2] = {
    {0x12, 0x04},  // COM7: set RGB mode
    {0x8C, 0x00},  // RGB444 disable
    {0x40, 0xD0}   // COM15: set RGB565 full-range
};
